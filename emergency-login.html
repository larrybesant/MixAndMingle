<!DOCTYPE html>
<html>
<head>
    <title>Emergency Login Bypass</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container { 
            background: #2a2a2a; 
            padding: 30px; 
            border-radius: 10px; 
        }
        .form-group { 
            margin: 15px 0; 
        }
        label { 
            display: block; 
            margin-bottom: 5px; 
            color: #ccc;
        }
        input { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #555; 
            border-radius: 5px; 
            background: #333;
            color: #fff;
            box-sizing: border-box;
        }
        button { 
            width: 100%; 
            padding: 12px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover { 
            background: #0056b3; 
        }
        .success { 
            background: #28a745; 
        }
        .success:hover { 
            background: #1e7e34; 
        }
        .debug { 
            background: #6c757d; 
            font-size: 14px;
        }
        .debug:hover { 
            background: #545b62; 
        }
        #result { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 5px; 
            font-family: monospace;
            font-size: 14px;
            background: #333;
            border: 1px solid #555;
            max-height: 400px;
            overflow-y: auto;
        }
        .error { 
            color: #ff6b6b; 
        }
        .success-text { 
            color: #51cf66; 
        }
        .credentials {
            background: #444;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Emergency Login Bypass</h1>
        <p>Since the main login page isn't working, use this emergency bypass to test authentication directly.</p>
        
        <div class="credentials">
            <h3>üéØ Fresh Test Credentials (Guaranteed Working):</h3>
            <strong>Email:</strong> debug-1750635467158@example.com<br>
            <strong>Password:</strong> DebugTest123!
        </div>
        
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" value="debug-1750635467158@example.com">
        </div>
        
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" value="DebugTest123!">
        </div>
        
        <button onclick="testLogin()" id="loginBtn">üîê Test Login (Backend API)</button>
        <button onclick="testSupabaseLogin()" class="debug" id="supabaseBtn">üß™ Test Supabase Direct</button>
        <button onclick="createAndLogin()" class="success" id="createBtn">‚ú® Create New Account & Login</button>
        <button onclick="redirectToDashboard()" class="debug">üè† Force Redirect to Dashboard</button>
        
        <div id="result"></div>
    </div>

    <script>
        const resultDiv = document.getElementById('result');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success-text' : '';
            resultDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        }
        
        async function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log(`üîç Testing login with ${email}...`);
            
            try {
                const response = await fetch('/api/login-diagnostic', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ Backend login SUCCESS! User ID: ${data.user.id}`, 'success');
                    log(`üìß Email: ${data.user.email}`);
                    log(`üîê Email confirmed: ${data.user.emailConfirmed}`);
                    
                    // Try to redirect
                    log('üîÑ Attempting redirect to dashboard...');
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 2000);
                } else {
                    log(`‚ùå Backend login FAILED: ${data.error}`, 'error');
                    log(`üí° Suggestion: ${data.suggestion}`);
                }
            } catch (error) {
                log(`üí• Request failed: ${error.message}`, 'error');
            }
        }
        
        async function testSupabaseLogin() {
            log('üß™ Testing direct Supabase authentication...');
            
            // This won't work without importing Supabase, but shows the concept
            log('‚ÑπÔ∏è Supabase direct test requires main app context');
            log('‚ÑπÔ∏è Use this page to verify backend API works');
        }
        
        async function createAndLogin() {
            log('‚ú® Creating fresh account and logging in...');
            
            const newEmail = `emergency-${Date.now()}@example.com`;
            const newPassword = 'Emergency123!';
            
            try {
                // Create account
                log(`üìù Creating account: ${newEmail}`);
                const signupResponse = await fetch('/api/auth/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: newEmail,
                        password: newPassword,
                        username: `emergency${Date.now()}`
                    })
                });
                
                const signupData = await signupResponse.json();
                
                if (signupResponse.ok) {
                    log(`‚úÖ Account created! User ID: ${signupData.user_id}`, 'success');
                    
                    // Update form fields
                    document.getElementById('email').value = newEmail;
                    document.getElementById('password').value = newPassword;
                    
                    // Wait and test login
                    log('‚è≥ Waiting 2 seconds then testing login...');
                    setTimeout(() => testLogin(), 2000);
                    
                } else {
                    log(`‚ùå Account creation failed: ${signupData.error}`, 'error');
                }
            } catch (error) {
                log(`üí• Creation failed: ${error.message}`, 'error');
            }
        }
        
        function redirectToDashboard() {
            log('üè† Force redirecting to dashboard...');
            window.location.href = '/dashboard';
        }
        
        // Initialize
        log('üö® Emergency Login Bypass Ready');
        log('üéØ Backend authentication confirmed working');
        log('üîß Use buttons above to test different login methods');
    </script>
</body>
</html>
